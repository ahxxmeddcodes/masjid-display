<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Masjid Display</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f2f1e6;
      color: #582f0c;
      height: 100vh;
      overflow: hidden;
    }

    .screen {
      display: flex;
      flex-direction: row;
      height: 100vh;
      width: 100vw;
    }

    /* LEFT SIDE: MASJID + PRAYER TIMES */

    .left {
      width: 35%;
      padding: 36px 40px 40px 40px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      background: #f2f1e6;
      border-right: 1px solid rgba(51, 65, 85, 0.7);
    }

    .header-block {
      margin-bottom: 20px;
    }

    .masjid-name {
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #000000;
    }

    .masjid-tagline {
      font-size: 1.1rem;
      color: #000000;
      margin-top: 4px;
    }

    .date-time {
      margin-top: 16px;
      font-size: 1.35rem;
      color: #000000;
    }

    .hijri-date {
      margin-top: 4px;
      font-size: 1.1rem;
      font-style: italic;
      color: #000000;
    }

    .prayer-card {
      margin-top: 24px;
      padding: 16px 14px;
      border-radius: 18px;
      background: #f2f1e6;
      box-shadow: 0 14px 40px rgba(88,47,12,0.25);
    }

    .widget-box {
      margin-top: 10px;
      padding: 6px;
      border-radius: 10px;
      background: #f2f1e6;
      box-shadow: 0 4px 12px rgba(88,47,12,0.12);
      max-height: 250px;
      overflow: hidden;
    }

    .prayer-card-title {
      font-size: 1.4rem;
      font-weight: 700;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      color: #000000;
    }

    .method-text {
      font-size: 1rem;
      color: #000000;
      margin-bottom: 12px;
    }

    .next-badge {
      font-size: 0.7rem;
      color: #000000;
      border-radius: 999px;
      border: 1px solid #582f0c;
      padding: 2px 8px;
      display: inline-block;
      box-shadow: 0 0 18px #582f0c;
    }

    .prayer-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .prayer-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 16px;
      border-radius: 10px;
      background: #f2f1e6;
      border: 1px solid #582f0c;
      font-size: 1.35rem;
      color: #000000;
    }

    .prayer-row-label {
      font-weight: 700;
      font-size: 1.35rem;
    }

    .prayer-row-time {
      font-variant-numeric: tabular-nums;
      font-weight: 700;
      font-size: 1.35rem;
    }

    .prayer-row.next {
      background: #f2f1e6;
      border-color: #582f0c;
    }

    .next-prayer-panel {
      margin-top: 16px;
      padding: 12px 14px;
      border-radius: 16px;
      background: #f2f1e6;
      border: 1px solid #582f0c;
      box-shadow: 0 0 22px #582f0c;
    }

    .next-prayer-label {
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      margin-bottom: 4px;
      color: #000000;
    }

    .next-prayer-text {
      font-size: 1.2rem;
      font-weight: 700;
      color: #000000;
    }

    .iqamah-label {
      font-size: 0.7em;
      font-weight: 500;
      display: block;
      margin-top: 2px;
    }

    .footer {
      font-size: 1rem;
      color: #000000;
    }

    /* RIGHT SIDE: SLIDESHOW */

    .right {
      width: 65%;
      padding: 20px 24px;
      display: flex;
      flex-direction: column;
      background: #f2f1e6;
      position: relative;
    }

   .quran-widget {
  padding: 8px 12px;
  border-radius: 16px;
  background: #f2f1e6;
  border: 1px solid #582f0c;
  box-shadow: 0 0 22px #582f0c;
} 

    .quran-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .quran-ayah {
      font-size: 1rem;
      font-weight: 500;
      margin-bottom: 2px;
    }

    .quran-ref {
      font-size: 0.8rem;
      color: #555555;
    }

    .slide-frame {
      width: 100%;
      flex: 1;
      margin-top: 10px;
      margin-bottom: 10px;
      border-radius: 26px;
      overflow: hidden;
      background: #f2f1e6;
      box-shadow: 0 18px 50px rgba(88,47,12,0.25);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .slide-frame img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: opacity 0.6s ease-in-out;
      opacity: 1;
    }

    .slide-frame img.fade-out {
      opacity: 0;
    }

    .slide-dots {
      position: absolute;
      bottom: 18px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 6px;
    }

    .dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      border: 1px solid #582f0c;
      background: transparent;
    }

    .dot.active {
      background: #582f0c;
      border-color: #582f0c;
    }

    @media (max-width: 900px) {
      .screen {
        flex-direction: column;
      }
      .left, .right {
        width: 100%;
        height: 50vh;
      }
    }
  </style>
</head>
<body>
  <div class="screen">
    <!-- LEFT PANEL -->
    <div class="left">
      <div>
        <div class="header-block">
          <div class="masjid-name" id="masjidName">Masjid An Nur</div>
          <div class="masjid-tagline">Prayer Times</div>
          <div class="date-time" id="dateTime"></div>
          <div class="hijri-date" id="hijriDate"></div>
        </div>

        <div class="prayer-card">
          <div class="prayer-card-title">
            <span>Today's Prayer Times</span>
          </div>
          <div class="method-text" id="methodText">Loading prayer times…</div>
          <div class="prayer-list" id="prayerList">
            <!-- Filled by JavaScript -->
          </div>
        </div>

        <div class="next-prayer-panel">
          <div class="next-prayer-label">Next Prayer</div>
          <div class="next-prayer-text" id="nextPrayerPanel">Loading...</div>
        </div>
      </div>

      <div class="footer">
        Display managed by Masjid An Nur
      </div>
    </div>

    <!-- RIGHT PANEL -->
    <div class="right">
      <div class="quran-widget">
        <div class="quran-label">Qur'an Reminder</div>
        <div class="quran-ayah" id="quranAyah"></div>
        <div class="quran-ref" id="quranRef"></div>
      </div>
      <div class="slide-frame">
        <img id="slideImage" src="" alt="Masjid announcement slide" />
      </div>
      <div class="slide-dots" id="slideDots"></div>
      <div class="widget-box" id="widgetBox">
        <script src="https://elfsightcdn.com/platform.js" async></script>
        <div class="elfsight-app-ddda69fe-8123-465f-baab-168e90473277" data-elfsight-app-lazy></div>
      </div>
    </div>
  </div>

  <script>
    /****************************************
     * CONFIGURATION
     ****************************************/

    // Change these to your own details
    const MASJID_NAME = "Masjid An Nur";
    const CITY = "Lithonia";
    const COUNTRY = "United States";
    // 2 = ISNA (common for North America). Change if your masjid uses a different method.
    const CALC_METHOD = 2;

    // Slides folder and files (relative to this HTML file)
   const SLIDES = [
  "slides/slide1.jpg",
  "slides/slide2.jpg",
  "slides/slide3.jpg",
  "slides/slide4.jpg",
  "slides/slide5.jpg",
  "slides/slide6.jpg",
  "slides/slide7.jpg"
      // Add more file paths here
    ];

    // Time each slide is shown (in milliseconds)
    const SLIDE_DURATION = 20000; // 20 seconds

    // Qur'an verses to rotate through on the right panel
    const QURAN_VERSES = [
      {
        text: "Indeed, in the remembrance of Allah do hearts find rest.",
        ref: "Surah Ar-Ra'd 13:28"
      },
      {
        text: "So remember Me; I will remember you. And be grateful to Me and do not deny Me.",
        ref: "Surah Al-Baqarah 2:152"
      },
      {
        text: "And whoever relies upon Allah - then He is sufficient for him.",
        ref: "Surah At-Talaq 65:3"
      },
      {
        text: "So which of the favors of your Lord would you deny?",
        ref: "Surah Ar-Rahman 55:13"
      },
      {
        text: "And whoever fears Allah - He will make for him a way out.",
        ref: "Surah At-Talaq 65:2"
      },
      {
        text: "Allah does not burden a soul beyond that it can bear.",
        ref: "Surah Al-Baqarah 2:286"
      },
      {
        text: "Indeed, with hardship [will be] ease.",
        ref: "Surah Ash-Sharh 94:6"
      },
      {
        text: "So be patient. Indeed, the promise of Allah is truth.",
        ref: "Surah Ar-Rum 30:60"
      },
      {
        text: "And establish prayer for My remembrance.",
        ref: "Surah Ta-Ha 20:14"
      },
      {
        text: "Indeed, prayer prohibits immorality and wrongdoing.",
        ref: "Surah Al-Ankabut 29:45"
      },
      {
        text: "And whoever does good deeds, whether male or female, while being a believer - those will enter Paradise.",
        ref: "Surah An-Nisa 4:124"
      },
      {
        text: "O you who have believed, respond to Allah and to the Messenger when he calls you to that which gives you life.",
        ref: "Surah Al-Anfal 8:24"
      },
      {
        text: "And whoever is grateful, his gratitude is only for [the benefit of] himself.",
        ref: "Surah Luqman 31:12"
      },
      {
        text: "And your Lord says, Call upon Me; I will respond to you.",
        ref: "Surah Ghafir 40:60"
      },
      {
        text: "Unquestionably, by the remembrance of Allah hearts find rest.",
        ref: "Surah Ar-Ra'd 13:28"
      },
      {
        text: "And whoever does righteous deeds, whether male or female, while being a believer - We will surely give them a good life.",
        ref: "Surah An-Nahl 16:97"
      },
      {
        text: "Indeed, Allah loves the doers of good.",
        ref: "Surah Al-Baqarah 2:195"
      },
      {
        text: "And seek help through patience and prayer.",
        ref: "Surah Al-Baqarah 2:45"
      },
      {
        text: "So be mindful of Allah as much as you are able.",
        ref: "Surah At-Taghabun 64:16"
      },
      {
        text: "And whoever puts his trust in Allah, then He will suffice him.",
        ref: "Surah At-Talaq 65:3"
      },
      {
        text: "And whoever comes to Him as a believer having done righteous deeds - for those will be the highest degrees.",
        ref: "Surah Ta-Ha 20:75"
      },
      {
        text: "Say, Indeed, my prayer, my sacrifice, my living and my dying are for Allah, Lord of the worlds.",
        ref: "Surah Al-An'am 6:162"
      },
      {
        text: "So race to [all that is] good.",
        ref: "Surah Al-Baqarah 2:148"
      },
      {
        text: "Indeed, Allah is with the patient.",
        ref: "Surah Al-Baqarah 2:153"
      },
      {
        text: "And whoever turns away from My remembrance - indeed, he will have a depressed life.",
        ref: "Surah Ta-Ha 20:124"
      }
    ];

    /****************************************
     * CLOCK (DATE + TIME)
     ****************************************/

    function updateClock() {
      const now = new Date();

      const dateOptions = {
        weekday: "long",
        year: "numeric",
        month: "long",
        day: "numeric"
      };
      const timeOptions = {
        hour: "numeric",
        minute: "2-digit",
        hour12: true
      };

      const dateStr = now.toLocaleDateString(undefined, dateOptions);
      const timeStr = now.toLocaleTimeString(undefined, timeOptions);

      const dateTimeEl = document.getElementById("dateTime");
      dateTimeEl.textContent = `${dateStr} • ${timeStr}`;
    }

    setInterval(updateClock, 1000);
    updateClock();

    /****************************************
     * PRAYER TIMES
     ****************************************/

    // Convert "HH:MM" (24‑hour) → "h:MM AM/PM"
    function to12Hour(timeStr) {
      const [hour, minute] = timeStr.split(":").map(Number);
      const suffix = hour >= 12 ? "PM" : "AM";
      const h12 = hour % 12 || 12;
      return `${h12}:${minute.toString().padStart(2,"0")} ${suffix}`;
    }

    // Add minutes to a "HH:MM" time string (24-hour) and return new "HH:MM"
    function addMinutesToTime(timeStr, minutesToAdd) {
      const [hour, minute] = timeStr.split(":").map(Number);
      const baseDate = new Date(2000, 0, 1, hour, minute);
      baseDate.setMinutes(baseDate.getMinutes() + minutesToAdd);
      const newHour = baseDate.getHours();
      const newMinute = baseDate.getMinutes();
      return `${String(newHour).padStart(2, "0")}:${String(newMinute).padStart(2, "0")}`;
    }

    let prayerSchedule = []; // Will store today's prayers as Date objects

    async function loadPrayerTimes() {
      const methodText = document.getElementById("methodText");
      const listEl = document.getElementById("prayerList");

      try {
        methodText.textContent = "Loading prayer times…";
        listEl.innerHTML = "";

        const url =
          "https://api.aladhan.com/v1/timingsByCity?city=" +
          encodeURIComponent(CITY) +
          "&country=" +
          encodeURIComponent(COUNTRY) +
          "&method=" +
          CALC_METHOD;

        const res = await fetch(url);
        const json = await res.json();

        if (json.code !== 200) {
          methodText.textContent = "Error loading prayer times.";
          return;
        }

        const data = json.data;
        const timings = data.timings;

        // Hide location and calculation method in the UI
        methodText.textContent = "";

        // Set Hijri date under the main date/time
        const hijri = data.date && data.date.hijri;
        const hijriEl = document.getElementById("hijriDate");
        if (hijri && hijriEl) {
          hijriEl.textContent = `${hijri.day} ${hijri.month.en} ${hijri.year} AH`;
        }

        // Define which prayers to show and in what order
        const prayersToShow = [
          "Fajr",
          "Sunrise",
          "Dhuhr",
          "Asr",
          "Maghrib",
          "Isha"
        ];

        const now = new Date();
        prayerSchedule = [];

        prayersToShow.forEach((name) => {
          const timeStr = timings[name]; // e.g. "05:34"
          if (!timeStr) return;

          const [hour, minute] = timeStr.split(":").map(Number);
          const dt = new Date(
            now.getFullYear(),
            now.getMonth(),
            now.getDate(),
            hour,
            minute
          );

          prayerSchedule.push({
            name,
            timeStr,
            date: dt
          });
        });

        // Render rows
        listEl.innerHTML = "";
        prayerSchedule.forEach((p) => {
          const row = document.createElement("div");
          row.className = "prayer-row";

          const label = document.createElement("div");
          label.className = "prayer-row-label";
          label.textContent = p.name;

          const time = document.createElement("div");
          time.className = "prayer-row-time";

          // Base adhan time (converted to 12-hour)
          const adhan12 = to12Hour(p.timeStr);

          // Compute iqamah time: +15 mins for all except Maghrib, which is +2 mins.
          let iqamahText = "";
          if (["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"].includes(p.name)) {
            const offset = p.name === "Maghrib" ? 2 : 15;
            const iqamah24 = addMinutesToTime(p.timeStr, offset);
            const iqamah12 = to12Hour(iqamah24);
            iqamahText = `Iqamah ${iqamah12}`;
          }

          if (iqamahText) {
            time.innerHTML = `${adhan12}<br><span class="iqamah-label">${iqamahText}</span>`;
          } else {
            time.textContent = adhan12;
          }

          row.appendChild(label);
          row.appendChild(time);
          listEl.appendChild(row);
        });

        // Highlight next prayer once now; then keep updating
        updateNextPrayerHighlight();
      } catch (err) {
        console.error(err);
        methodText.textContent = "Failed to load prayer times.";
      }
    }

    function updateNextPrayerHighlight() {
  if (!prayerSchedule || prayerSchedule.length === 0) return;

  const now = new Date();
  const THIRTY_MIN = 30 * 60 * 1000;
  let nextPrayer = null;

  // Determine the next upcoming prayer
  for (const p of prayerSchedule) {
    if (p.date > now) {
      nextPrayer = p;
      break;
    }
  }

  // If all prayers are past, consider the first prayer as the "next" (for the next day)
  if (!nextPrayer) {
    nextPrayer = prayerSchedule[0];
  }

  const rows = document.querySelectorAll(".prayer-row");

  // Remove old highlights
  rows.forEach((row) => {
    row.classList.remove("next");
    row.classList.remove("current-glow");
  });

  // Add "next" border highlight to the upcoming prayer
  rows.forEach((row) => {
    const label = row.querySelector(".prayer-row-label");
    if (label && label.textContent === nextPrayer.name) {
      row.classList.add("next");
    }
  });

  // Add glow to the CURRENT prayer (±30 min window)
  rows.forEach((row, index) => {
    const p = prayerSchedule[index];
    if (!p) return;
    const diff = now - p.date; // positive if now is after prayer time
    if (Math.abs(diff) <= THIRTY_MIN) {
      row.classList.add("current-glow");
    }
  });

  // Update the next prayer panel at the bottom
  const nextPanel = document.getElementById("nextPrayerPanel");
  if (nextPanel) {
    const adhan12 = to12Hour(nextPrayer.timeStr);

    // Compute iqamah time: +15 mins for all except Maghrib, which is +2 mins.
    let iqamahText = "";
    if (["Fajr", "Dhuhr", "Asr", "Maghrib", "Isha"].includes(nextPrayer.name)) {
      const offset = nextPrayer.name === "Maghrib" ? 2 : 15;
      const iqamah24 = addMinutesToTime(nextPrayer.timeStr, offset);
      const iqamah12 = to12Hour(iqamah24);
      iqamahText = `Iqamah ${iqamah12}`;
    }

    if (iqamahText) {
      nextPanel.innerHTML = `${nextPrayer.name} at ${adhan12}<br><span class="iqamah-label">${iqamahText}</span>`;
    } else {
      nextPanel.textContent = `${nextPrayer.name} at ${adhan12}`;
    }
  }
}

    // Load once on page load
    loadPrayerTimes();
    // Refresh times every 6 hours (more than enough)
    setInterval(loadPrayerTimes, 6 * 60 * 60 * 1000);
    // Update highlight every 30 seconds
    setInterval(updateNextPrayerHighlight, 30 * 1000);

    /****************************************
     * SLIDESHOW
     ****************************************/

    let currentSlideIndex = 0;
    const slideImageEl = document.getElementById("slideImage");
    const dotsContainer = document.getElementById("slideDots");

    function initSlideshow() {
      if (!SLIDES || SLIDES.length === 0) {
        slideImageEl.alt = "No slides configured";
        return;
      }

      // Create dots
      dotsContainer.innerHTML = "";
      SLIDES.forEach((_, index) => {
        const dot = document.createElement("div");
        dot.className = "dot" + (index === 0 ? " active" : "");
        dotsContainer.appendChild(dot);
      });

      // Show first slide
      slideImageEl.src = SLIDES[0];
    }

    function showSlide(nextIndex) {
      if (!SLIDES || SLIDES.length === 0) return;

      currentSlideIndex =
        (nextIndex + SLIDES.length) % SLIDES.length;

      // Fade effect
      slideImageEl.classList.add("fade-out");
      setTimeout(() => {
        slideImageEl.src = SLIDES[currentSlideIndex];
        slideImageEl.classList.remove("fade-out");
        updateDots();
      }, 300);
    }

    function updateDots() {
      const dots = dotsContainer.querySelectorAll(".dot");
      dots.forEach((dot, index) => {
        dot.classList.toggle("active", index === currentSlideIndex);
      });
    }

    function startSlideshow() {
      if (!SLIDES || SLIDES.length === 0) return;
      initSlideshow();
      setInterval(() => {
        showSlide(currentSlideIndex + 1);
      }, SLIDE_DURATION);
    }

    function initQuranWidget() {
      const ayahEl = document.getElementById("quranAyah");
      const refEl = document.getElementById("quranRef");
      if (!ayahEl || !refEl || !QURAN_VERSES.length) return;

      let index = 0;

      function showVerse(i) {
        const verse = QURAN_VERSES[i];
        ayahEl.textContent = verse.text;
        refEl.textContent = verse.ref;
      }

      showVerse(index);

      setInterval(() => {
        index = (index + 1) % QURAN_VERSES.length;
        showVerse(index);
      }, 20000); // change verse every 20 seconds
    }

    // Set masjid name from config
    document.getElementById("masjidName").textContent = MASJID_NAME;

    // Start slideshow
    startSlideshow();

    // Start rotating Qur'an verses
    initQuranWidget();
  </script>
</body>
</html>